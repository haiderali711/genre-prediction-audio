# Which Docker image shall be used on the GitLab runner?
image: docker:latest

# Details about how to connect to the Docker service to run this build.
variables:
  DOCKER_HOST: tcp://docker:2375
  DOCKER_DRIVER: overlay2
  # Create the certificates inside this directory for both the server
  # and client. The certificates used by the client will be created in
  # /certs/client so we only need to share this directory with the
  # volume mount in `config.toml`.
  DOCKER_TLS_CERTDIR: "/certs"

services:
  - name: docker:dind

stages:
  - build
  - deploy
  # - test

# This section describes what shall be done to build and test the project.
build-and-test:
  # Display information before we start the build.
  before_script:
    # - cd $CI_PROJECT_PATH/genre-recognition/genre_classification
    - docker info
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  tags:
    - docker-build
  stage: build
  script:
    - ls -a
    - docker build --pull --no-cache -f ./genre-recognition/genre_classification/Dockerfile .
# # This section describes what shall be done to deploy artefacts from the project.
# push-to-registry:
#   before_script:
#     - cd $CI_PROJECT_PATH/genre-recognition/genre_classification
#     - docker info
#     - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
#   tags:
#     - docker-build
#   stage: deploy
#   only:
#     - master
#   script:
#     - docker build -t "$CI_REGISTRY_IMAGE":"$CI_COMMIT_SHA" --push "."
